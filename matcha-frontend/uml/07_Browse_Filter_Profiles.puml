@startuml
skinparam DPI 300
title Browse & Filter Profiles - GET /api/profile Extended

participant Client
participant "Backend API" as API

note over Client, API
Browse all profiles (no filters)
end note

Client -> API: GET /api/profile\nAuth: Bearer <token>
activate API
API --> Client: HTTP 401\n{msg: "Unauthorized"}
deactivate API

Client -> API: GET /api/profile\nAuth: Bearer <token>\nNo query parameters
activate API
API --> Client: HTTP 200\n{ProfileShort[]}\nAll active profiles (default: skip=0, limit=20)
deactivate API

note over Client, API
Filter by age range
end note

Client -> API: GET /api/profile\nAuth: Bearer <token>\nQuery: minAge=-5, maxAge=30
activate API
API --> Client: HTTP 400\n{msg: "Invalid age range"}
deactivate API

Client -> API: GET /api/profile\nAuth: Bearer <token>\nQuery: minAge=25, maxAge=20\nInvalid range
activate API
API --> Client: HTTP 400\n{msg: "minAge cannot be greater than maxAge"}
deactivate API

Client -> API: GET /api/profile\nAuth: Bearer <token>\nQuery: minAge=25, maxAge=35
activate API
API --> Client: HTTP 200\n{ProfileShort[]}\nProfiles aged 25-35
deactivate API

note over Client, API
Filter by distance
end note

Client -> API: GET /api/profile\nAuth: Bearer <token>\nQuery: distancekm=-10
activate API
API --> Client: HTTP 400\n{msg: "Distance must be positive"}
deactivate API

Client -> API: GET /api/profile\nAuth: Bearer <token>\nQuery: distancekm=50
activate API
API --> Client: HTTP 200\n{ProfileShort[]}\nProfiles within 50km
deactivate API

Client -> API: GET /api/profile\nAuth: Bearer <token>\nQuery: distancekm=1000\nNo user location set
activate API
API --> Client: HTTP 400\n{msg: "User location not set"}
deactivate API

note over Client, API
Filter by fame rating
end note

Client -> API: GET /api/profile\nAuth: Bearer <token>\nQuery: minFameRating=invalid
activate API
API --> Client: HTTP 400\n{msg: "minFameRating must be a number"}
deactivate API

Client -> API: GET /api/profile\nAuth: Bearer <token>\nQuery: minFameRating=50, maxFameRating=200
activate API
API --> Client: HTTP 200\n{ProfileShort[]}\nProfiles with fame rating 50-200
deactivate API

note over Client, API
Combine multiple filters
end note

Client -> API: GET /api/profile\nAuth: Bearer <token>\nQuery: minAge=25, maxAge=35,\nminFameRating=50, distancekm=50
activate API
API --> Client: HTTP 200\n{ProfileShort[]}\nProfiles matching ALL filters
deactivate API

note over Client, API
Pagination - Load more
end note

Client -> API: GET /api/profile\nAuth: Bearer <token>\nQuery: minAge=25, maxAge=35,\nskip=0, limit=20
activate API
API --> Client: HTTP 200\n{ProfileShort[]} (20 profiles)\nFirst page
deactivate API

Client -> API: GET /api/profile\nAuth: Bearer <token>\nQuery: minAge=25, maxAge=35,\nskip=20, limit=20
activate API
API --> Client: HTTP 200\n{ProfileShort[]} (20 profiles)\nSecond page
deactivate API

Client -> API: GET /api/profile\nAuth: Bearer <token>\nQuery: minAge=25, maxAge=35,\nskip=100, limit=20
activate API
API --> Client: HTTP 200\n{ProfileShort[]} (empty)\nNo more results
deactivate API

note over Client, API
Sexual preference filtering (auto)
end note

Client -> API: GET /api/profile\nAuth: Bearer <token>\nBackend auto-filters by sexual preference
activate API
API --> Client: HTTP 200\n{ProfileShort[]}\nFiltered by sexual preference compatibility
deactivate API

note over Client, API
Exclude blocked & already liked users
end note

Client -> API: GET /api/profile\nAuth: Bearer <token>\nQuery: minAge=25, maxAge=35
activate API
API --> Client: HTTP 200\n{ProfileShort[]}\nExcluding:\n- Blocked users\n- Already liked users\n- Users who blocked you\nWith connectionStatus showing liked/likedBack/matched
deactivate API

note over Client, API
Get profile with connection status
end note

Client -> API: GET /api/profile\nAuth: Bearer <token>\nQuery: minAge=25, maxAge=35, limit=5
activate API
API --> Client: HTTP 200\n{ProfileShort[]\n{\n  id, username, firstName, photo0,\n  fameRating, birthDate, lastOnline,\n  connectionStatus: {\n    userid,\n    liked: boolean,\n    likedBack: boolean,\n    matched: boolean\n  }\n}}
deactivate API

note over Client, API
Filter limit constraints
end note

Client -> API: GET /api/profile\nAuth: Bearer <token>\nQuery: limit=1\nToo small
activate API
API --> Client: HTTP 400\n{msg: "Limit must be at least 10"} OR\nHTTP 200 with default limit
deactivate API

Client -> API: GET /api/profile\nAuth: Bearer <token>\nQuery: limit=500\nToo large
activate API
API --> Client: HTTP 400\n{msg: "Limit cannot exceed 100"} OR\nHTTP 200 capped at 100
deactivate API

note over Client, API
Get short profile of specific user
end note

Client -> API: GET /api/profile/short/:userId\nAuth: Bearer <token>\nUser doesn't exist
activate API
API --> Client: HTTP 404\n{msg: "User not found"}
deactivate API

Client -> API: GET /api/profile/short/:userId\nAuth: Bearer <token>\nUser is blocked by you or blocked you
activate API
API --> Client: HTTP 403\n{msg: "Forbidden"}
deactivate API

Client -> API: GET /api/profile/short/:userId\nAuth: Bearer <token>\nValid user
activate API
API --> Client: HTTP 200\n{ProfileShort: {id, username, firstName,\nphoto0, fameRating, lastOnline, birthDate,\nuserTags, distance, connectionStatus}}
deactivate API

note over Client, API
Get full profile of specific user
end note

Client -> API: GET /api/profile/:userId\nAuth: Bearer <token>\nInvalid user
activate API
API --> Client: HTTP 404\n{msg: "User not found"}
deactivate API

Client -> API: GET /api/profile/:userId\nAuth: Bearer <token>\nValid user
activate API
API --> Client: HTTP 200\n{ProfileGetJson: {id, username, email,\nfirstName, lastName, birthDate, gender,\nsexualPreference, biography, fameRating,\nphoto0-4, lastOnline, tags,\nconnectionStatus: {userid, liked, likedBack, matched}}}
deactivate API

@enduml
